// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: Apache-2.0

import Link from "@cloudscape-design/components/link";

import { CartesianChart, CartesianChartProps } from "../../../lib/components";
import { dateFormatter, numberFormatter, percentageFormatter } from "../../common/formatters";
import { useChartSettings } from "../../common/page-settings";
import { PageSection } from "../../common/templates";

const series: CartesianChartProps.SeriesOptions[] = [
  {
    name: "CPU1",
    type: "area",
    data: [
      {
        x: 1600984800000,
        y: 0.11879533073929961,
      },
      {
        x: 1600985700000,
        y: 0.14208560311284046,
      },
      {
        x: 1600986600000,
        y: 0.14633047989623865,
      },
      {
        x: 1600987500000,
        y: 0.12792529182879378,
      },
      {
        x: 1600988400000,
        y: 0.1265431906614786,
      },
      {
        x: 1600989300000,
        y: 0.12437665369649804,
      },
      {
        x: 1600990200000,
        y: 0.13730324254215304,
      },
      {
        x: 1600991100000,
        y: 0.1316513618677043,
      },
      {
        x: 1600992000000,
        y: 0.14375408560311284,
      },
      {
        x: 1600992900000,
        y: 0.14973696498054476,
      },
      {
        x: 1600993800000,
        y: 0.12567367055771725,
      },
      {
        x: 1600994700000,
        y: 0.11769649805447471,
      },
      {
        x: 1600995600000,
        y: 0.1410230869001297,
      },
      {
        x: 1600996500000,
        y: 0.1173810635538262,
      },
      {
        x: 1600997400000,
        y: 0.12403424124513618,
      },
      {
        x: 1600998300000,
        y: 0.12901478599221788,
      },
      {
        x: 1600999200000,
        y: 0.13891984435797666,
      },
      {
        x: 1601000100000,
        y: 0.14056861219195851,
      },
      {
        x: 1601001000000,
        y: 0.1361214007782101,
      },
      {
        x: 1601001900000,
        y: 0.14129805447470817,
      },
      {
        x: 1601002800000,
        y: 0.14985421530479898,
      },
      {
        x: 1601003700000,
        y: 0.11973229571984437,
      },
      {
        x: 1601004600000,
        y: 0.14454682230869,
      },
      {
        x: 1601005500000,
        y: 0.1333509727626459,
      },
      {
        x: 1601006400000,
        y: 0.11119066147859921,
      },
      {
        x: 1601007300000,
        y: 0.11443112840466925,
      },
      {
        x: 1601008200000,
        y: 0.13957250324254214,
      },
      {
        x: 1601009100000,
        y: 0.11549779507133592,
      },
      {
        x: 1601010000000,
        y: 0.14805291828793773,
      },
      {
        x: 1601010900000,
        y: 0.1355662775616083,
      },
      {
        x: 1601011800000,
        y: 0.15503813229571983,
      },
      {
        x: 1601012700000,
        y: 0.12650894941634241,
      },
    ],
  },
  {
    name: "CPU2",
    type: "area",
    data: [
      {
        x: 1600984800000,
        y: 0.1313857328145266,
      },
      {
        x: 1600985700000,
        y: 0.15256549935149158,
      },
      {
        x: 1600986600000,
        y: 0.14162178988326848,
      },
      {
        x: 1600987500000,
        y: 0.15541167315175097,
      },
      {
        x: 1600988400000,
        y: 0.13147600518806743,
      },
      {
        x: 1600989300000,
        y: 0.11202490272373541,
      },
      {
        x: 1600990200000,
        y: 0.13693281452658884,
      },
      {
        x: 1600991100000,
        y: 0.15257587548638132,
      },
      {
        x: 1600992000000,
        y: 0.12727470817120623,
      },
      {
        x: 1600992900000,
        y: 0.1166651102464332,
      },
      {
        x: 1600993800000,
        y: 0.13817587548638133,
      },
      {
        x: 1600994700000,
        y: 0.10018988326848248,
      },
      {
        x: 1600995600000,
        y: 0.12684409857328144,
      },
      {
        x: 1600996500000,
        y: 0.1029810635538262,
      },
      {
        x: 1600997400000,
        y: 0.15013540856031127,
      },
      {
        x: 1600998300000,
        y: 0.15517198443579766,
      },
      {
        x: 1600999200000,
        y: 0.1298396887159533,
      },
      {
        x: 1601000100000,
        y: 0.12954085603112842,
      },
      {
        x: 1601001000000,
        y: 0.10663346303501946,
      },
      {
        x: 1601001900000,
        y: 0.09411984435797666,
      },
      {
        x: 1601002800000,
        y: 0.12106977950713359,
      },
      {
        x: 1601003700000,
        y: 0.13847678339818417,
      },
      {
        x: 1601004600000,
        y: 0.11526848249027237,
      },
      {
        x: 1601005500000,
        y: 0.10887782101167316,
      },
      {
        x: 1601006400000,
        y: 0.13845291828793774,
      },
      {
        x: 1601007300000,
        y: 0.14058728923476005,
      },
      {
        x: 1601008200000,
        y: 0.10500440985732813,
      },
      {
        x: 1601009100000,
        y: 0.09681556420233463,
      },
      {
        x: 1601010000000,
        y: 0.10691880674448768,
      },
      {
        x: 1601010900000,
        y: 0.14403112840466925,
      },
      {
        x: 1601011800000,
        y: 0.11747756160830092,
      },
      {
        x: 1601012700000,
        y: 0.14765654993514915,
      },
    ],
  },
  {
    name: "CPU3",
    type: "area",
    data: [
      {
        x: 1600984800000,
        y: 0.010804669260700388,
      },
      {
        x: 1600985700000,
        y: 0.02758184176394293,
      },
      {
        x: 1600986600000,
        y: 0.04730791180285344,
      },
      {
        x: 1600987500000,
        y: 0.06839740596627757,
      },
      {
        x: 1600988400000,
        y: 0.07909001297016861,
      },
      {
        x: 1600989300000,
        y: 0.06473151750972762,
      },
      {
        x: 1600990200000,
        y: 0.08646433203631647,
      },
      {
        x: 1600991100000,
        y: 0.13199377431906614,
      },
      {
        x: 1600992000000,
        y: 0.10874396887159532,
      },
      {
        x: 1600992900000,
        y: 0.15138677042801554,
      },
      {
        x: 1600993800000,
        y: 0.1259403372243839,
      },
      {
        x: 1600994700000,
        y: 0.1172171206225681,
      },
      {
        x: 1600995600000,
        y: 0.15072684824902724,
      },
      {
        x: 1600996500000,
        y: 0.14481141374837875,
      },
      {
        x: 1600997400000,
        y: 0.1331704280155642,
      },
      {
        x: 1600998300000,
        y: 0.12739195849546045,
      },
      {
        x: 1600999200000,
        y: 0.15086485084306095,
      },
      {
        x: 1601000100000,
        y: 0.18314811932555122,
      },
      {
        x: 1601001000000,
        y: 0.20856653696498054,
      },
      {
        x: 1601001900000,
        y: 0.20393047989623866,
      },
      {
        x: 1601002800000,
        y: 0.22181374837872891,
      },
      {
        x: 1601003700000,
        y: 0.21278962386511024,
      },
      {
        x: 1601004600000,
        y: 0.22450739299610895,
      },
      {
        x: 1601005500000,
        y: 0.1653810635538262,
      },
      {
        x: 1601006400000,
        y: 0.2478360570687419,
      },
      {
        x: 1601007300000,
        y: 0.21530479896238652,
      },
      {
        x: 1601008200000,
        y: 0.19414785992217898,
      },
      {
        x: 1601009100000,
        y: 0.3259818417639429,
      },
      {
        x: 1601010000000,
        y: 0.17188378728923476,
      },
      {
        x: 1601010900000,
        y: 0.18218832684824904,
      },
      {
        x: 1601011800000,
        y: 0.238694682230869,
      },
      {
        x: 1601012700000,
        y: 0.3049328145265888,
      },
    ],
  },
  {
    name: "CPU4",
    type: "area",
    data: [
      {
        x: 1600984800000,
        y: 0.4169463035019455,
      },
      {
        x: 1600985700000,
        y: 0.2213769130998703,
      },
      {
        x: 1600986600000,
        y: 0.16022723735408562,
      },
      {
        x: 1600987500000,
        y: 0.11987963683527886,
      },
      {
        x: 1600988400000,
        y: 0.14835382619974058,
      },
      {
        x: 1600989300000,
        y: 0.10211258106355382,
      },
      {
        x: 1600990200000,
        y: 0.07866044098573281,
      },
      {
        x: 1600991100000,
        y: 0.06610428015564201,
      },
      {
        x: 1600992000000,
        y: 0.07220752269779507,
      },
      {
        x: 1600992900000,
        y: 0.07288715953307393,
      },
      {
        x: 1600993800000,
        y: 0.04931984435797666,
      },
      {
        x: 1600994700000,
        y: 0.05281867704280156,
      },
      {
        x: 1600995600000,
        y: 0.04482075226977951,
      },
      {
        x: 1600996500000,
        y: 0.04784954604409857,
      },
      {
        x: 1600997400000,
        y: 0.043612970168612195,
      },
      {
        x: 1600998300000,
        y: 0.03713203631647211,
      },
      {
        x: 1600999200000,
        y: 0.04359429312581064,
      },
      {
        x: 1601000100000,
        y: 0.039395071335927366,
      },
      {
        x: 1601001000000,
        y: 0.037094682230869,
      },
      {
        x: 1601001900000,
        y: 0.03044980544747082,
      },
      {
        x: 1601002800000,
        y: 0.02587081712062257,
      },
      {
        x: 1601003700000,
        y: 0.028407782101167314,
      },
      {
        x: 1601004600000,
        y: 0.025798184176394293,
      },
      {
        x: 1601005500000,
        y: 0.02083942931258106,
      },
      {
        x: 1601006400000,
        y: 0.02171413748378729,
      },
      {
        x: 1601007300000,
        y: 0.020902723735408562,
      },
      {
        x: 1601008200000,
        y: 0.025170428015564204,
      },
      {
        x: 1601009100000,
        y: 0.022062775616083007,
      },
      {
        x: 1601010000000,
        y: 0.020867444876783398,
      },
      {
        x: 1601010900000,
        y: 0.022508949416342416,
      },
      {
        x: 1601011800000,
        y: 0.019239429312581064,
      },
      {
        x: 1601012700000,
        y: 0.018333592736705578,
      },
    ],
  },
  {
    name: "CPU5",
    type: "area",
    data: [
      {
        x: 1600984800000,
        y: 0.035286121919584953,
      },
      {
        x: 1600985700000,
        y: 0.029357198443579768,
      },
      {
        x: 1600986600000,
        y: 0.03726070038910506,
      },
      {
        x: 1600987500000,
        y: 0.048325810635538265,
      },
      {
        x: 1600988400000,
        y: 0.03768300907911803,
      },
      {
        x: 1600989300000,
        y: 0.03875175097276264,
      },
      {
        x: 1600990200000,
        y: 0.04819818417639429,
      },
      {
        x: 1600991100000,
        y: 0.07545421530479897,
      },
      {
        x: 1600992000000,
        y: 0.060908949416342416,
      },
      {
        x: 1600992900000,
        y: 0.09228845654993516,
      },
      {
        x: 1600993800000,
        y: 0.1118651102464332,
      },
      {
        x: 1600994700000,
        y: 0.12358495460440987,
      },
      {
        x: 1600995600000,
        y: 0.1346241245136187,
      },
      {
        x: 1600996500000,
        y: 0.1371569390402075,
      },
      {
        x: 1600997400000,
        y: 0.21250739299610896,
      },
      {
        x: 1600998300000,
        y: 0.37775771725032425,
      },
      {
        x: 1600999200000,
        y: 0.3320861219195849,
      },
      {
        x: 1601000100000,
        y: 0.39978002594033724,
      },
      {
        x: 1601001000000,
        y: 0.14514552529182878,
      },
      {
        x: 1601001900000,
        y: 0.1176207522697795,
      },
      {
        x: 1601002800000,
        y: 0.09372140077821012,
      },
      {
        x: 1601003700000,
        y: 0.08439844357976653,
      },
      {
        x: 1601004600000,
        y: 0.09929961089494163,
      },
      {
        x: 1601005500000,
        y: 0.0669260700389105,
      },
      {
        x: 1601006400000,
        y: 0.06256186770428016,
      },
      {
        x: 1601007300000,
        y: 0.060151491569390404,
      },
      {
        x: 1601008200000,
        y: 0.06549105058365759,
      },
      {
        x: 1601009100000,
        y: 0.04230350194552529,
      },
      {
        x: 1601010000000,
        y: 0.04555849546044098,
      },
      {
        x: 1601010900000,
        y: 0.030188326848249028,
      },
      {
        x: 1601011800000,
        y: 0.034107392996108946,
      },
      {
        x: 1601012700000,
        y: 0.044323735408560314,
      },
    ],
  },
  {
    name: "CPU6",
    type: "area",
    data: [
      {
        x: 1600984800000,
        y: 0.10952944228274968,
      },
      {
        x: 1600985700000,
        y: 0.1410614785992218,
      },
      {
        x: 1600986600000,
        y: 0.10770635538261997,
      },
      {
        x: 1600987500000,
        y: 0.1404171206225681,
      },
      {
        x: 1600988400000,
        y: 0.11001504539559015,
      },
      {
        x: 1600989300000,
        y: 0.11049546044098574,
      },
      {
        x: 1600990200000,
        y: 0.14370946822308692,
      },
      {
        x: 1600991100000,
        y: 0.14083320363164722,
      },
      {
        x: 1600992000000,
        y: 0.11042697795071335,
      },
      {
        x: 1600992900000,
        y: 0.14704643320363164,
      },
      {
        x: 1600993800000,
        y: 0.1471118028534371,
      },
      {
        x: 1600994700000,
        y: 0.14830817120622566,
      },
      {
        x: 1600995600000,
        y: 0.10513618677042802,
      },
      {
        x: 1600996500000,
        y: 0.1139911802853437,
      },
      {
        x: 1600997400000,
        y: 0.15371206225680933,
      },
      {
        x: 1600998300000,
        y: 0.15401089494163422,
      },
      {
        x: 1600999200000,
        y: 0.10528664072632944,
      },
      {
        x: 1601000100000,
        y: 0.10756731517509728,
      },
      {
        x: 1601001000000,
        y: 0.10576601815823607,
      },
      {
        x: 1601001900000,
        y: 0.1062028534370947,
      },
      {
        x: 1601002800000,
        y: 0.1485011673151751,
      },
      {
        x: 1601003700000,
        y: 0.1044669260700389,
      },
      {
        x: 1601004600000,
        y: 0.11177587548638133,
      },
      {
        x: 1601005500000,
        y: 0.10890376134889754,
      },
      {
        x: 1601006400000,
        y: 0.14598495460440986,
      },
      {
        x: 1601007300000,
        y: 0.10602749675745785,
      },
      {
        x: 1601008200000,
        y: 0.1505431906614786,
      },
      {
        x: 1601009100000,
        y: 0.11074656290531777,
      },
      {
        x: 1601010000000,
        y: 0.11062827496757459,
      },
      {
        x: 1601010900000,
        y: 0.106021271076524,
      },
      {
        x: 1601011800000,
        y: 0.14992892347600517,
      },
      {
        x: 1601012700000,
        y: 0.14492347600518807,
      },
    ],
  },
];

export function ExampleAreaChartStackedAreaChartMultipleMetrics() {
  const { chartProps, isEmpty } = useChartSettings();
  return (
    <PageSection
      title="Area chart: Stacked area chart, multiple metrics"
      subtitle={
        <Link href="https://cloudscape.aws.dev/components/area-chart?tabId=playground&example=stacked-area-chart%2C-multiple-metrics">
          compare with the website playground example
        </Link>
      }
    >
      <CartesianChart
        {...chartProps.cartesian}
        chartHeight={379}
        ariaLabel="Stacked area chart, multiple metrics"
        stacking="normal"
        series={isEmpty ? [] : series}
        tooltip={{
          ...chartProps.cartesian.tooltip,
          footer: ({ x }) => {
            const total = findY(x as number, series[0])! + findY(x as number, series[1])!;
            return (
              <div
                style={{
                  display: "flex",
                  justifyContent: "space-between",
                }}
              >
                <span>Total</span>
                <span>{numberFormatter(total)}</span>
              </div>
            );
          },
        }}
        xAxis={{
          type: "datetime",
          title: "Time (UTC)",
          min: 1600984800000,
          max: 1601012700000,
          valueFormatter: dateFormatter,
        }}
        yAxis={{
          title: "Total CPU load",
          min: 0,
          max: 1,
          valueFormatter: percentageFormatter,
        }}
      />
    </PageSection>
  );
}

function findY(x: number, series: CartesianChartProps.SeriesOptions) {
  if (!("data" in series)) {
    return null;
  }
  for (const d of series.data) {
    if (d && typeof d === "object" && "x" in d && d.x === x) {
      return (d as any).y;
    }
  }
  return null;
}
